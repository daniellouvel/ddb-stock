<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DDB-Stock v2 - Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
    <!-- Header -->
    <header class="bg-blue-600 text-white shadow-lg">
        <div class="container mx-auto px-4 py-4">
            <div class="flex justify-between items-center">
                <div>
                    <h1 class="text-3xl font-bold">üè† DDB-Stock v2</h1>
                    <p class="text-blue-200">Gestion d'inventaire domestique</p>
                </div>
                <nav class="space-x-4">
                    <a href="index.html" class="text-white font-bold">Dashboard</a>
                    <a href="produits.html" class="hover:text-blue-200">Produits</a>
                    <a href="emplacements.html" class="hover:text-blue-200">Emplacements</a>
                    <a href="articles.html" class="hover:text-blue-200">Articles</a>
                </nav>
            </div>
        </div>
    </header>

    <div class="container mx-auto px-4 py-8">
        <!-- Statistiques -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="bg-white rounded-lg shadow-lg p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm font-medium">Produits</p>
                        <p class="text-3xl font-bold text-blue-600" id="statProduits">-</p>
                    </div>
                    <div class="text-4xl">üì¶</div>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-lg p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm font-medium">Emplacements</p>
                        <p class="text-3xl font-bold text-green-600" id="statEmplacements">-</p>
                    </div>
                    <div class="text-4xl">üìç</div>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-lg p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm font-medium">Articles</p>
                        <p class="text-3xl font-bold text-purple-600" id="statArticles">-</p>
                    </div>
                    <div class="text-4xl">üè∑Ô∏è</div>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-lg p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm font-medium">Total Quantit√©s</p>
                        <p class="text-3xl font-bold text-orange-600" id="statQuantites">-</p>
                    </div>
                    <div class="text-4xl">üìä</div>
                </div>
            </div>
        </div>

        <!-- Acc√®s rapides -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="bg-white rounded-lg shadow-lg p-6 hover:shadow-xl transition">
                <h2 class="text-xl font-bold text-gray-800 mb-3">üì¶ Produits</h2>
                <p class="text-gray-600 mb-4">G√©rer le r√©f√©rentiel des produits (EAN, nom, marque, description)</p>
                <a href="produits.html">
                    <button class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition">
                        Acc√©der ‚Üí
                    </button>
                </a>
            </div>

            <div class="bg-white rounded-lg shadow-lg p-6 hover:shadow-xl transition">
                <h2 class="text-xl font-bold text-gray-800 mb-3">üìç Emplacements</h2>
                <p class="text-gray-600 mb-4">G√©rer la hi√©rarchie des lieux de stockage (pi√®ces, meubles, bo√Ætes)</p>
                <a href="emplacements.html">
                    <button class="w-full bg-green-600 text-white py-2 px-4 rounded-md hover:bg-green-700 transition">
                        Acc√©der ‚Üí
                    </button>
                </a>
            </div>

            <div class="bg-white rounded-lg shadow-lg p-6 hover:shadow-xl transition">
                <h2 class="text-xl font-bold text-gray-800 mb-3">üè∑Ô∏è Articles</h2>
                <p class="text-gray-600 mb-4">G√©rer les articles physiques rang√©s (quantit√©s, emplacements, p√©remption)</p>
                <a href="articles.html">
                    <button class="w-full bg-purple-600 text-white py-2 px-4 rounded-md hover:bg-purple-700 transition">
                        Acc√©der ‚Üí
                    </button>
                </a>
            </div>
        </div>

        <!-- Alertes -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-xl font-bold text-gray-800 mb-4">‚ö†Ô∏è Alertes et Notifications</h2>
            <div id="alertes" class="space-y-3">
                <div class="text-gray-500 text-center py-4">Chargement des alertes...</div>
            </div>
        </div>

        <!-- Derniers articles ajout√©s -->
        <div class="bg-white rounded-lg shadow-lg p-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-gray-800">üìã Derniers Articles Ajout√©s</h2>
                <button onclick="chargerDerniers()" class="text-blue-600 hover:text-blue-800 text-sm">
                    üîÑ Rafra√Æchir
                </button>
            </div>
            <div id="derniersArticles" class="space-y-2">
                <div class="text-gray-500 text-center py-4">Chargement...</div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white mt-12 py-6">
        <div class="container mx-auto px-4 text-center">
            <p>DDB-Stock v2.0 - Syst√®me de gestion d'inventaire domestique</p>
            <p class="text-gray-400 text-sm mt-2">
                <a href="http://192.168.1.200:8000/docs" target="_blank" class="hover:text-white">API Documentation</a>
            </p>
        </div>
    </footer>

    <script>
        const API_URL = 'http://' + window.location.hostname + ':8000';

        // Charger au d√©marrage
        window.onload = function() {
            chargerStatistiques();
            chargerAlertes();
            chargerDerniers();
        };

        // Charger les statistiques
        async function chargerStatistiques() {
            try {
                // Produits
                const produits = await fetch(`${API_URL}/produits/`).then(r => r.json());
                document.getElementById('statProduits').textContent = produits.length;

                // Emplacements
                const emplacements = await fetch(`${API_URL}/emplacements/`).then(r => r.json());
                document.getElementById('statEmplacements').textContent = emplacements.length;

                // Articles
                const articles = await fetch(`${API_URL}/articles/`).then(r => r.json());
                document.getElementById('statArticles').textContent = articles.length;

                // Total quantit√©s
                const totalQuantites = articles.reduce((sum, art) => sum + art.quantite, 0);
                document.getElementById('statQuantites').textContent = totalQuantites;

            } catch (error) {
                console.error('Erreur chargement stats:', error);
            }
        }

        // Charger les alertes
        async function chargerAlertes() {
            try {
                // Articles proches p√©remption (30 jours)
                const proche = await fetch(`${API_URL}/articles/peremption/prochaines?jours=30`).then(r => r.json());
                
                // Articles expir√©s
                const expires = await fetch(`${API_URL}/articles/peremption/expirees`).then(r => r.json());

                const container = document.getElementById('alertes');
                let html = '';

                if (expires.length > 0) {
                    html += `
                        <div class="bg-red-50 border-l-4 border-red-500 p-4">
                            <div class="flex items-center">
                                <div class="text-2xl mr-3">üö®</div>
                                <div>
                                    <p class="font-bold text-red-800">Articles expir√©s</p>
                                    <p class="text-red-600">${expires.length} article(s) p√©rim√©(s)</p>
                                </div>
                            </div>
                        </div>
                    `;
                }

                if (proche.length > 0) {
                    html += `
                        <div class="bg-orange-50 border-l-4 border-orange-500 p-4">
                            <div class="flex items-center">
                                <div class="text-2xl mr-3">‚ö†Ô∏è</div>
                                <div>
                                    <p class="font-bold text-orange-800">P√©remption proche</p>
                                    <p class="text-orange-600">${proche.length} article(s) p√©riment dans 30 jours</p>
                                </div>
                            </div>
                        </div>
                    `;
                }

                if (html === '') {
                    html = '<div class="text-green-600 text-center py-4">‚úÖ Aucune alerte</div>';
                }

                container.innerHTML = html;

            } catch (error) {
                document.getElementById('alertes').innerHTML = 
                    '<div class="text-gray-500 text-center py-4">Erreur chargement alertes</div>';
                console.error('Erreur:', error);
            }
        }

        // Charger derniers articles
        async function chargerDerniers() {
            try {
                const articles = await fetch(`${API_URL}/articles/`).then(r => r.json());
                const produits = await fetch(`${API_URL}/produits/`).then(r => r.json());
                const emplacements = await fetch(`${API_URL}/emplacements/`).then(r => r.json());

                // Cr√©er des maps pour recherche rapide
                const produitsMap = {};
                produits.forEach(p => produitsMap[p.id] = p);
                
                const emplacementsMap = {};
                emplacements.forEach(e => emplacementsMap[e.id] = e);

                // Prendre les 5 derniers
                const derniers = articles.slice(-5).reverse();

                const container = document.getElementById('derniersArticles');

                if (derniers.length === 0) {
                    container.innerHTML = '<div class="text-gray-500 text-center py-4">Aucun article</div>';
                    return;
                }

                let html = '';
                derniers.forEach(article => {
                    const produit = produitsMap[article.produit_id] || {nom: 'Inconnu'};
                    const emplacement = emplacementsMap[article.emplacement_id] || {nom: 'Inconnu', code_emplacement: '-'};
                    
                    html += `
                        <div class="border border-gray-200 rounded-md p-3 hover:bg-gray-50 transition">
                            <div class="flex justify-between items-start">
                                <div class="flex-1">
                                    <div class="font-semibold text-gray-800">
                                        ${article.code_article} - ${produit.nom}
                                    </div>
                                    <div class="text-sm text-gray-600 mt-1">
                                        üìç ${emplacement.nom} (${emplacement.code_emplacement})
                                        ‚Ä¢ Quantit√©: ${article.quantite}
                                    </div>
                                    ${article.commentaire ? 
                                        `<div class="text-xs text-gray-500 mt-1">${article.commentaire}</div>` : 
                                        ''}
                                </div>
                            </div>
                        </div>
                    `;
                });

                container.innerHTML = html;

            } catch (error) {
                document.getElementById('derniersArticles').innerHTML = 
                    '<div class="text-gray-500 text-center py-4">Erreur chargement articles</div>';
                console.error('Erreur:', error);
            }
        }
    </script>
</body>
</html>
```

---

## ‚úÖ Sauvegarder et Tester

**Acc√©dez √† votre dashboard** :
```
http://192.168.1.200:8000/web/
```

ou
```
http://192.168.1.200:8000/web/index.html
```

---

## üéØ Fonctionnalit√©s du Dashboard

‚úÖ **4 Statistiques en temps r√©el** (Produits, Emplacements, Articles, Quantit√©s)  
‚úÖ **3 Acc√®s rapides** avec boutons vers les pages  
‚úÖ **Alertes p√©remption** (expir√©s + proche expiration)  
‚úÖ **Derniers articles ajout√©s** (5 derniers)  
‚úÖ **Design moderne** avec Tailwind CSS  
‚úÖ **Navigation** vers toutes les pages  
‚úÖ **Rafra√Æchissement** des donn√©es  

---

## üåê Navigation Compl√®te

Votre site web a maintenant :
```
http://192.168.1.200:8000/web/
‚îú‚îÄ‚îÄ index.html         ‚Üí Dashboard avec stats
‚îú‚îÄ‚îÄ produits.html      ‚Üí Gestion produits
‚îú‚îÄ‚îÄ emplacements.html  ‚Üí Gestion emplacements (nouvelle page)
‚îî‚îÄ‚îÄ articles.html      ‚Üí Gestion articles (√† cr√©er)
